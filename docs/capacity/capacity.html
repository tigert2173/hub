<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site at Capacity</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="logo-container">
    <img src="../images/logotransparent.png" alt="Logo" class="logo">
  </div>

  <div class="loader">
    <div class="circle one"></div>
    <div class="circle two"></div>
    <div class="circle three"></div>
  </div>

  <div class="message">
    <h1>Uh-oh! Our site is a bit crowded ğŸš¶â€â™‚ï¸ğŸš¶â€â™€ï¸</h1>
    <p><b>Weâ€™re experiencing high traffic, but hang tight!</b><br>
    Number of users waiting: <span id="waitingCount">0</span><br>
    Estimated wait time: <span id="waitTime">0</span> minutes</p>
    <p>Weâ€™ll get you in soon! In the meantime, enjoy some lighthearted fun while you wait ğŸ˜„</p>
  </div>

  <!-- Joke Image Container -->
  <div class="joke-image-container">
    <img src="../images/QueueBot.png" alt="Queue Bot" class="botimage">
    <div class="joke-container">
      <p class="joke-text">"I tried to start a queue, but now everyone's in line!"</p>
    </div>
  </div>

  <script>
    // Queue humor logic
    const jokeContainer = document.querySelector('.joke-container');
    const jokeText = document.querySelector('.joke-text');

    const jokes = [
      "â€œI tried to start a queue, but now everyone's in line!â€",
      "â€œPatience is a virtue, and right now itâ€™s your best friend!â€",
      "â€œWaiting builds character... or so I've been told!â€",
      "â€œGood things come to those who waitâ€¦ like access to this site!â€",
      "â€œThey say the best part is worth the wait!â€",
      "â€œCue the queue jokes! See what I did there?â€",
      "â€œPatience: Because all great things take time!â€",
      "â€œWaiting: the art of being okay with not getting in right now!â€",
      "â€œI hope youâ€™ve brushed up on your waiting skills!â€",
      "â€œHang tight! We're working hard to clear some space!â€",
      "â€œSometimes, the journey is just as fun as the destinationâ€¦ hopefully!â€",
      "â€œIf patience is a skill, youâ€™re about to level up!â€",
      "â€œHang in there! We promise the wait will be worth it.â€",
      "â€œMaybe think of it as a suspenseful plot twist?â€",
      "â€œA little queue humor to pass the time!â€",
      "â€œWaiting: a small price to pay for something great!â€",
    ];

    function showJoke() {
      jokeText.textContent = jokes[Math.floor(Math.random() * jokes.length)];
      jokeContainer.classList.add('show');
      
      setTimeout(() => {
        jokeContainer.classList.remove('show');
      }, 12000); // Show joke for 12 seconds
    }

    setInterval(showJoke, Math.random() * 4000 + 12500);

    showJoke();

    // Waiting info logic
    let waitingCount = 0;
    const waitTimePerPerson = 2; // Estimated time in minutes per person

    function updateWaitingInfo() {
      fetch('/api/waiting-count')
        .then(response => response.json())
        .then(data => {
          waitingCount = data.waitingCount;
          document.getElementById('waitingCount').textContent = waitingCount;
          document.getElementById('waitTime').textContent = Math.ceil(waitingCount * waitTimePerPerson);

          // Check if a slot is available
          if (waitingCount < 1) {
            window.location.href = '/'; // Redirect to the main page if a slot is free
          }
        })
        .catch(error => console.error('Error fetching waiting count:', error));
    }

    // Simulate users joining the queue
    setInterval(updateWaitingInfo, 3000); // Update every 3 seconds
  </script>
</body>
</html>
